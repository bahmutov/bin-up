#!/usr/bin/env node

const programName = process.argv[2]
if (!programName) {
  console.error('bin-up: finds bin link in node_modules/.bin folders')
  console.error('up to the Git root folder')
  console.error('usage: $(bin-up <name>)')
  console.error('for example:')
  console.error('$(bin-up mocha) --verbose test/*.js')

  console.error('')
  console.error('ALTERNATIVE:')
  console.error('if you pass arguments the found tool will be invoked')
  console.error('  bin-up mocha --verbose test/*.js')
  console.error('will call mocha from bin-up')
  console.error('which helps on Windows')
  process.exit(1)
}

const binUp = require('..')
const found = binUp(programName)
if (!found) {
  console.error('bin-up: could find %s, I am sorry, is it installed?',
    programName)
  process.exit(1)
}

const args = process.argv.slice(3)
if (args.length) {
  // we passed arguments to bin-up
  // so we need to call the found tool with them
  const execa = require('execa')
  execa(programName, args, {stdio: 'inherit'})
    .catch(result => {
      console.error('Problem running', programName, args)
      console.error(result.stderr)
      process.exit(result.code)
    })
} else {
  // just return the name of the tool
  console.log(found)
}
